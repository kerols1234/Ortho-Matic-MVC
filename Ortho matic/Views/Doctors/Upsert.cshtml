@model Ortho_matic.Models.ViewModels.AddDoctorVM

@{
    ViewData["Title"] = Model.Doctor.Id == 0 ? "Create" : "Edit";
}

<div class="row" style="width:100%">
    <div class="col-12 card custom-card">
        <div class="row">
            <input asp-for="Doctor.Id" hidden class="form-control" type="text">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <div class="form-group col-3">
                <label asp-for="Doctor.Name" class="control-label"></label>
                <input asp-for="Doctor.Name" class="form-control" />
                <span asp-validation-for="Doctor.Name" class="text-danger"></span>
            </div>
            <div class="form-group col-3">
                <label asp-for="Doctor.DoctorSpecialty" class="control-label"></label>
                <select asp-for="Doctor.DoctorSpecialty" asp-items="@Model.DoctorSpecialtySelectList" class="form-control"></select>
                <span asp-validation-for="Doctor.DoctorSpecialty" class="text-danger"></span>
            </div>
            <div class="form-group col-3">
                <label asp-for="Doctor.DoctorDegree" class="control-label"></label>
                <select asp-for="Doctor.DoctorDegree" asp-items="@Model.DoctorDegreeSelectList" class="form-control"></select>
                <span asp-validation-for="Doctor.DoctorDegree" class="text-danger"></span>
            </div>
            <div class="form-group col-3">
                <label asp-for="Doctor.PhoneNumber" class="control-label"></label>
                <input asp-for="Doctor.PhoneNumber" class="form-control" />
                <span asp-validation-for="Doctor.PhoneNumber" class="text-danger"></span>
            </div>
        </div>
    </div>
    <div class="col-12 card custom-card">
        <div class="row">
            <h1 class="col-12">Clinics</h1>
        </div>
        <div class="row">
            <div class="form-group col-12">
                <label for="Clinic" class="control-label">Clinic</label>
                <select id="Clinic" asp-items="@Model.ClinicSelectList" class="form-control"></select>
            </div>

            <h2 class="col-12">Best time</h2>

            <div class="form-group col-3">
                <label for="startDayBestClinic" class="control-label">startDay</label>
                <select id="startDayBestClinic" asp-items="@Model.DaySelectList" class="form-control"></select>
            </div>
            <div class="form-group col-3">
                <label for="endDayBestClinic" class="control-label">endDay</label>
                <select id="endDayBestClinic" asp-items="@Model.DaySelectList" class="form-control"></select>
            </div>
            <div class="form-group col-3">
                <label for="startTimeBestClinic" class="control-label">startTime</label>
                <input id="startTimeBestClinic" name="startTime" type="time" class="form-control" />
            </div>
            <div class="form-group col-3">
                <label for="endTimeBestClinic" class="control-label">endTime</label>
                <input id="endTimeBestClinic" name="endTime" type="time" class="form-control" />
            </div>

            <h2 class="col-12">Times</h2>

            <div class="form-group col-3">
                <label for="startDayClinic" class="control-label">startDay</label>
                <select id="startDayClinic" asp-items="@Model.DaySelectList" class="form-control"></select>
            </div>
            <div class="form-group col-3">
                <label for="endDayClinic" class="control-label">endDay</label>
                <select id="endDayClinic" asp-items="@Model.DaySelectList" class="form-control"></select>
            </div>
            <div class="form-group col-2">
                <label for="startTimeClinic" class="control-label">startTime</label>
                <input id="startTimeClinic" name="startTime" type="time" class="form-control" />
            </div>
            <div class="form-group col-2">
                <label for="endTimeClinic" class="control-label">endTime</label>
                <input id="endTimeClinic" name="endTime" type="time" class="form-control" />
            </div>
            <div class="form-group col-2">
                <label for="add_time_clinic" class="control-label">&nbsp;</label>
                <button type="button" id="add_time_clinic" class="form-control btn btn-outline-info">Add</button>
            </div>

            <div class="form-group col-12">
                <table class="table form-group col-12" id="t_times_clinic">
                    <thead>
                        <tr>
                            <th scope="col" width="23%">startDay</th>
                            <th scope="col" width="23%">endDay</th>
                            <th scope="col" width="23%">startTime</th>
                            <th scope="col" width="23%">endTime</th>
                            <th scope="col"></th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>

            </div>
        </div>
    </div>
    <div class="col-12 card custom-card">
        <div class="row">
            <h1 class="col-12">Hospitals</h1>
        </div>
        <div class="row">
            <div class="form-group col-12">
                <label for="Hospital" class="control-label">Hospital</label>
                <select id="Hospital" asp-items="@Model.HospitsalSelectList" class="form-control"></select>
            </div>

            <h2 class="col-12">Best time</h2>

            <div class="form-group col-3">
                <label for="startDayBestHospital" class="control-label">startDay</label>
                <select id="startDayBestHospital" asp-items="@Model.DaySelectList" class="form-control"></select>
            </div>
            <div class="form-group col-3">
                <label for="endDayBestHospital" class="control-label">endDay</label>
                <select id="endDayBestHospital" asp-items="@Model.DaySelectList" class="form-control"></select>
            </div>
            <div class="form-group col-3">
                <label for="startTimeBestHospital" class="control-label">startTime</label>
                <input id="startTimeBestHospital" name="startTime" type="time" class="form-control" />
            </div>
            <div class="form-group col-3">
                <label for="endTimeBestHospital" class="control-label">endTime</label>
                <input id="endTimeBestHospital" name="endTime" type="time" class="form-control" />
            </div>

            <h2 class="col-12">Times</h2>

            <div class="form-group col-3">
                <label for="startDayHospital" class="control-label">startDay</label>
                <select id="startDayHospital" asp-items="@Model.DaySelectList" class="form-control"></select>
            </div>
            <div class="form-group col-3">
                <label for="endDayHospital" class="control-label">endDay</label>
                <select id="endDayHospital" asp-items="@Model.DaySelectList" class="form-control"></select>
            </div>
            <div class="form-group col-2">
                <label for="startTimeHospital" class="control-label">startTime</label>
                <input id="startTimeHospital" name="startTime" type="time" class="form-control" />
            </div>
            <div class="form-group col-2">
                <label for="endTimeHospital" class="control-label">endTime</label>
                <input id="endTimeHospital" name="endTime" type="time" class="form-control" />
            </div>
            <div class="form-group col-2">
                <label for="add_time_hospital" class="control-label">&nbsp;</label>
                <button type="button" id="add_time_hospital" class="form-control btn btn-outline-info">Add</button>
            </div>

            <div class="form-group col-12">
                <table class="table form-group col-12" id="t_times_hospital">
                    <thead>
                        <tr>
                            <th scope="col" width="23%">startDay</th>
                            <th scope="col" width="23%">endDay</th>
                            <th scope="col" width="23%">startTime</th>
                            <th scope="col" width="23%">endTime</th>
                            <th scope="col"></th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>

            </div>
        </div>
    </div>
    <div class="offset-9 form-group mt-3 col-3">
        <button type="button" id="btnSave" class="btn btn-info form-control">
            @ViewData["Title"]
        </button>
    </div>
</div>

@section Scripts{
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script src="~/js/t.js" asp-append-version="true"></script>
    <script type="text/javascript">
        $("body").on("click", "#add_time_hospital", function () {

            var txtStartTime = $("#startTimeHospital");
            var txtEndTime = $("#endTimeHospital");
            var txtStartDay = $("#startDayHospital option:selected");
            var txtEndDay = $("#endDayHospital option:selected");

            var data = new Date("2011-04-11T" + txtStartTime.val() + ":00");
            var ST = data.toLocaleString('en-GB', {
                hour12: true,
            }).split(",")[1].replace(":00 ", " ");


            data = new Date("2011-04-11T" + txtEndTime.val() + ":00");
            var ET = data.toLocaleString('en-GB', {
                hour12: true,
            }).split(",")[1].replace(":00 ", " ");


            if (txtEndTime.val() == "" || txtStartTime.val() == "") {
                return;
            }

            tTimes = $("#t_times_hospital")[0];

            var row = tTimes.insertRow(-1);

            var cell = $(row.insertCell(-1));
            cell.html(txtStartDay.val());

            cell = $(row.insertCell(-1));
            cell.html(txtEndDay.val());

            cell = $(row.insertCell(-1));
            cell.html(ST);

            cell = $(row.insertCell(-1));
            cell.html(ET);

            cell = $(row.insertCell(-1));
            var btnRemove = $("<input/>");

            btnRemove.attr("type", "button");
            btnRemove.attr("onclick", "Remove(this,'#t_times_hospital');");
            btnRemove.attr("class", "btn btn-danger btn-sm")
            btnRemove.val("x");
            cell.append(btnRemove);

            txtStartTime.val("");
            txtEndTime.val("");
        });

        $("body").on("click", "#add_time_clinic", function () {

            var txtStartTime = $("#startTimeClinic");
            var txtEndTime = $("#endTimeClinic");
            var txtStartDay = $("#startDayClinic option:selected");
            var txtEndDay = $("#endDayClinic option:selected");

            var data = new Date("2011-04-11T" + txtStartTime.val() + ":00");
            var ST = data.toLocaleString('en-GB', {
                hour12: true,
            }).split(",")[1].replace(":00 ", " ");

            data = new Date("2011-04-11T" + txtEndTime.val() + ":00");
            var ET = data.toLocaleString('en-GB', {
                hour12: true,
            }  ).split(",")[1].replace(":00 "," ");


              if(xtEndTime.val() == "" || txtStartTime.val() == "") {
                return;
            }

tTimes = $("#t_times_clinic")[0];
                
            var row = tTimes.insertRow(-1);

            var cell = $(row.insertCell(-1));
            cell.html(txtStartDay.val());

            cell = $(row.insertCell(-1));
            cell.html(txtEndDay.val());

            cell = $(row.insertCell(-1));
            cell.html(ST);

            cell = $(row.insertCell(-1));
            cell.html(ET);

            cell = $(row.insertCell(-1));
            var btnRemove = $("<input/>");

            btnRemove.attr("type", "button");
            btnRemove.attr("onclick", "Remove(this,'#t_times_clinic');");
            btnRemove.attr("class", "btn btn-danger btn-sm")
            btnRemove.val("x");
            cell.append(btnRemove);

            txtStartTime.val("");
            txtEndTime.val("");
        });

        function Remove(button, name) {
            var row = $(button).closest("TR");
            var name = $("TD", row).eq(0).html();
            if (confirm("Do you want to delete:" + name)) {
                var table = $(name)[0];
                table.deleteRow(row[0].rowIndex);
            }
        };

        $("body").on("click", "#btnSave", function () {
            var doctor = {};
            doctor.Id = $("#Doctor_Id").val();
            doctor.Name = $("#Doctor_Name").val();
            doctor.DoctorSpecialty = $("#Doctor_DoctorSpecialty option:selected").val();
            doctor.DoctorDegree = $("#Doctor_DoctorDegree option:selected").val();
            doctor.PhoneNumber = $("#Doctor_PhoneNumber").val();
            doctor.DoctorHospitals = [];
            doctor.DoctorClinics = [];
            
            $("#tblSkills TBODY TR").each(function () {
                var row = $(this);
                var skill = {};
                skill.skill_name = row.find("TD").eq(0).html();
                skill.skill_value = row.find("TD").eq(1).html();
                skills.push(skill);
            });



            console.log(JSON.stringify(doctor));
            
            $.ajax({
                type: "POST",
                url: "/Doctors/Upsert",
                data: JSON.stringify(doctor),
                    contentType: "application/json; charset=utf-8",
                        dataType: "json",
                 succ       ess: function (data) {
                     if (       data.success) {
                                toastr.success(data.message);
                                //location.reload();
                                               }
                      else   {
                            toastr.error(data.message);
        }
                        }
                    });
        });
    </script>
}













